# æ•°æ®åº“è¿ç§»æ–‡ä»¶è¯´æ˜

## ğŸ“ æ–‡ä»¶ç»“æ„

æ‰€æœ‰è¿ç§»æ–‡ä»¶å·²é‡æ„ä¸º**ç‹¬ç«‹çš„è¡¨åˆ›å»ºæ–‡ä»¶**ï¼Œæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£åˆ›å»ºä¸€ä¸ªè¡¨ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µå’Œé…ç½®ã€‚

### è¿ç§»æ–‡ä»¶åˆ—è¡¨ï¼ˆæŒ‰æ‰§è¡Œé¡ºåºï¼‰

1. **001_create_users_table.sql** - åˆ›å»ºç”¨æˆ·è¡¨
   - åŒ…å«æ‰€æœ‰ç”¨æˆ·å­—æ®µï¼šèº«ä»½æ ‡è¯†ã€èµ„æ–™ã€è®¤è¯ã€é’±åŒ…ç­‰
   - å®šä¹‰ `update_updated_at_column()` å‡½æ•°ï¼ˆä¾›å…¶ä»–è¡¨ä½¿ç”¨ï¼‰

2. **002_create_auth_tokens_table.sql** - åˆ›å»ºè®¤è¯ä»¤ç‰Œè¡¨
   - å­˜å‚¨ç”¨æˆ·çš„è®¤è¯ä»¤ç‰Œï¼ˆç”¨äº API è®¤è¯ï¼‰

3. **003_create_verification_tokens_table.sql** - åˆ›å»ºéªŒè¯ç è¡¨
   - å­˜å‚¨çŸ­ä¿¡/é‚®ç®±éªŒè¯ç 

4. **004_create_task_info_table.sql** - åˆ›å»ºä»»åŠ¡ä¿¡æ¯è¡¨
   - å­˜å‚¨å¤šäººä»»åŠ¡çš„åŸºæœ¬ä¿¡æ¯ï¼ˆæ‰€æœ‰å‚ä¸è€…å…±äº«ï¼‰
   - åŒ…å«ï¼šæ ‡é¢˜ã€æè¿°ã€æ—¶é—´ã€å‚ä¸è€…é™åˆ¶ã€å‡­è¯é…ç½®ç­‰

5. **005_create_tasks_table.sql** - åˆ›å»ºä»»åŠ¡è¡¨
   - æ¯ä¸ªè¡Œä»£è¡¨ä¸€ä¸ªåˆ›å»ºè€…-é¢†å–è€…å¯¹ï¼ˆæ”¯æŒå¤šäººä»»åŠ¡ï¼‰
   - **åŒ…å« timeline å­—æ®µ**ï¼ˆJSONBæ•°ç»„ï¼Œç”¨äºè®°å½•æ‰€æœ‰çŠ¶æ€å˜æ›´ï¼‰
   - åŒ…å«æ‰€æœ‰å­—æ®µï¼šçŠ¶æ€ã€å¥–åŠ±ã€å‡­è¯ã€æ—¶é—´æˆ³ç­‰

## âœ… å·²åˆ é™¤çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶å·²è¢«åˆ é™¤ï¼Œå…¶åŠŸèƒ½å·²æ•´åˆåˆ°ä¸Šè¿°æ–‡ä»¶ä¸­ï¼š

- âŒ `002_add_allow_repeat_claim.sql` â†’ å·²æ•´åˆåˆ° `005_create_tasks_table.sql`
- âŒ `007_add_creator_id_to_tasks.sql` â†’ å·²æ•´åˆåˆ° `005_create_tasks_table.sql`
- âŒ `008_add_user_profile_fields.sql` â†’ å·²æ•´åˆåˆ° `001_create_users_table.sql`
- âŒ `009_add_task_participant_fields.sql` â†’ å·²æ•´åˆåˆ° `005_create_tasks_table.sql`
- âŒ `010_add_task_timestamp_fields.sql` â†’ å·²æ•´åˆåˆ° `005_create_tasks_table.sql`
- âŒ `011_add_timeline_and_reject_option.sql` â†’ å·²æ•´åˆåˆ° `005_create_tasks_table.sql`
- âŒ `012_add_password_to_users.sql` â†’ å·²æ•´åˆåˆ° `001_create_users_table.sql`
- âŒ `013_refactor_multi_participant_tasks.sql` â†’ å·²æ•´åˆåˆ° `004_create_task_info_table.sql` å’Œ `005_create_tasks_table.sql`

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åœ¨æ–°æ•°æ®åº“ä¸­æ‰§è¡Œ

æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰è¿ç§»æ–‡ä»¶ï¼š

```sql
-- åœ¨ Supabase SQL Editor ä¸­ä¾æ¬¡æ‰§è¡Œï¼š
-- 1. 001_create_users_table.sql
-- 2. 002_create_auth_tokens_table.sql
-- 3. 003_create_verification_tokens_table.sql
-- 4. 004_create_task_info_table.sql
-- 5. 005_create_tasks_table.sql
```

### åœ¨ç°æœ‰æ•°æ®åº“ä¸­æ‰§è¡Œ

**âš ï¸ è­¦å‘Š**ï¼šå¦‚æœæ•°æ®åº“ä¸­å·²æœ‰æ•°æ®ï¼Œè¯·å…ˆå¤‡ä»½ï¼

è¿™äº›è¿ç§»æ–‡ä»¶ä½¿ç”¨ `CREATE TABLE IF NOT EXISTS`ï¼Œå¦‚æœè¡¨å·²å­˜åœ¨ï¼Œä¸ä¼šè¦†ç›–ç°æœ‰æ•°æ®ã€‚ä½†å¦‚æœè¡¨ç»“æ„ä¸åŒï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è¿ç§»æ•°æ®ã€‚

## ğŸ“Š è¡¨å…³ç³»

```
users (ç”¨æˆ·)
  â”œâ”€â”€ auth_tokens (è®¤è¯ä»¤ç‰Œ) [user_id]
  â”œâ”€â”€ verification_tokens (éªŒè¯ç ) [é€šè¿‡ phone/email å…³è”]
  â”œâ”€â”€ task_info (åˆ›å»ºçš„ä»»åŠ¡) [creator_id]
  â””â”€â”€ tasks (é¢†å–çš„ä»»åŠ¡) [claimer_id]

task_info (ä»»åŠ¡ä¿¡æ¯)
  â””â”€â”€ tasks (ä»»åŠ¡è¡Œ) [task_info_id]

tasks (ä»»åŠ¡)
  â”œâ”€â”€ task_info (ä»»åŠ¡ä¿¡æ¯) [task_info_id]
  â”œâ”€â”€ users (åˆ›å»ºè€…) [creator_id]
  â””â”€â”€ users (é¢†å–è€…) [claimer_id]
```

## ğŸ”‘ é‡è¦å­—æ®µè¯´æ˜

### tasks è¡¨çš„ timeline å­—æ®µ

`timeline` å­—æ®µæ˜¯ **JSONB æ•°ç»„**ï¼Œç”¨äºè®°å½•ä»»åŠ¡çš„æ‰€æœ‰çŠ¶æ€å˜æ›´äº‹ä»¶ï¼š

```json
[
  {
    "status": "unclaimed",
    "actorId": "user-uuid",
    "actorName": "ç”¨æˆ·å",
    "action": "åˆ›å»ºä»»åŠ¡",
    "timestamp": "2026-01-15T10:00:00Z"
  },
  {
    "status": "in_progress",
    "actorId": "user-uuid",
    "actorName": "ç”¨æˆ·å",
    "action": "é¢†å–ä»»åŠ¡",
    "timestamp": "2026-01-15T11:00:00Z"
  }
]
```

**é‡è¦**ï¼štimeline å­—æ®µåº”è¯¥**ä»…è¿½åŠ å†™å…¥**ï¼Œä¸è¦è¦†ç›–æ•´ä¸ªæ•°ç»„ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ‰§è¡Œé¡ºåºå¾ˆé‡è¦**ï¼šå¿…é¡»æŒ‰ 001 â†’ 005 çš„é¡ºåºæ‰§è¡Œï¼Œå› ä¸ºå­˜åœ¨å¤–é”®ä¾èµ–
2. **å‡½æ•°å®šä¹‰**ï¼š`update_updated_at_column()` å‡½æ•°åœ¨ 001 ä¸­å®šä¹‰ï¼Œå…¶ä»–æ–‡ä»¶ç›´æ¥ä½¿ç”¨
3. **è§¦å‘å™¨**ï¼šæ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·±çš„ `updated_at` è§¦å‘å™¨
4. **ç´¢å¼•**ï¼šæ‰€æœ‰å¿…è¦çš„ç´¢å¼•éƒ½å·²åˆ›å»ºï¼ŒåŒ…æ‹¬ GIN ç´¢å¼•ç”¨äº timeline å­—æ®µ

## ğŸ”„ åç»­è¿ç§»

å¦‚æœéœ€è¦æ·»åŠ æ–°å­—æ®µæˆ–ä¿®æ”¹è¡¨ç»“æ„ï¼Œè¯·åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶ï¼Œå‘½åæ ¼å¼ï¼š`006_add_xxx.sql`ã€`007_modify_xxx.sql` ç­‰ã€‚

---

**æœ€åæ›´æ–°**ï¼š2026-01-15
**é‡æ„åŸå› **ï¼šç®€åŒ–è¿ç§»æ–‡ä»¶ç»“æ„ï¼Œå°†æ‰€æœ‰å­—æ®µæ•´åˆåˆ°åˆå§‹åˆ›å»ºæ–‡ä»¶ä¸­
